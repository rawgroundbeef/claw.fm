---
phase: 09-frontend-profiles
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - web/src/pages/ArtistProfilePage.tsx
  - web/src/pages/NotFoundPage.tsx
  - web/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Profile page at /artist/:username displays avatar, display name, bio, and track catalog"
    - "Profile page shows skeleton placeholders while loading"
    - "Profile page shows error state with retry button on API failure"
    - "Non-existent artist username shows 404 page with link back to radio"
    - "Profile page for artist with no tracks shows empty track list message"
  artifacts:
    - path: "web/src/pages/ArtistProfilePage.tsx"
      provides: "Artist profile page with hero header, track catalog, loading/error/empty states"
      min_lines: 120
    - path: "web/src/pages/NotFoundPage.tsx"
      provides: "404 page with message and link back to radio"
      min_lines: 15
  key_links:
    - from: "web/src/pages/ArtistProfilePage.tsx"
      to: "/api/artist/:username"
      via: "fetch in useEffect on username param"
      pattern: "fetch.*api/artist"
    - from: "web/src/App.tsx"
      to: "web/src/pages/ArtistProfilePage.tsx"
      via: "Route path='artist/:username'"
      pattern: "artist/:username"
    - from: "web/src/App.tsx"
      to: "web/src/pages/NotFoundPage.tsx"
      via: "Route path='*' catch-all"
      pattern: 'path="\*"'
---

<objective>
Build the artist profile page and 404 page, and wire them into the router.

Purpose: This delivers the core profile viewing experience -- listeners can navigate to /artist/:username and see the artist's avatar, display name, bio, and track catalog. The 404 page handles non-existent usernames gracefully.

Output: ArtistProfilePage.tsx with hero header and track list, NotFoundPage.tsx, and updated App.tsx routes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-frontend-profiles/09-CONTEXT.md
@.planning/phases/09-frontend-profiles/09-RESEARCH.md
@.planning/phases/09-frontend-profiles/09-01-SUMMARY.md
@web/src/App.tsx
@web/src/contexts/AudioContext.tsx
@web/src/layouts/RadioLayout.tsx
@web/src/components/Player/NowPlaying.tsx
@web/src/index.css
@packages/shared/src/index.ts
@api/src/routes/artist.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ArtistProfilePage with hero header, track catalog, and all states</name>
  <files>web/src/pages/ArtistProfilePage.tsx</files>
  <action>
    Create `web/src/pages/ArtistProfilePage.tsx` that fetches and displays an artist profile.

    **Data fetching:**
    - Use `useParams()` from react-router to get `:username` from URL
    - Fetch `GET /api/artist/${username}` on mount and when username changes (useEffect with [username] dependency)
    - The API returns `ArtistProfileWithTracks` shape: `{ profile: ArtistPublicProfile, tracks: Track[] }`
    - Import types from `@claw/shared` (ArtistProfileWithTracks, ArtistPublicProfile, Track)
    - Use `API_URL` from constants for the fetch base URL
    - Track three states: `loading` (boolean), `error` (string | null), `data` (ArtistProfileWithTracks | null)
    - Separate 404 from other errors: if fetch returns 404, set data to null and loading to false (show NotFoundPage inline or navigate). If 5xx, set error message.

    **Hero header layout (Spotify-style):**
    - Large rounded-square avatar (128px on mobile, 192px on desktop) -- use `rounded-xl` for rounded-square, not full circle
    - If profile has avatarUrl: render `<img>` with src = avatarUrl prefixed with `/audio/` (R2 key needs the prefix, same as cover art)
    - If no avatarUrl: render the wallet-based identicon. The existing pattern in the codebase uses `data:` URI identicons for cover art (generated server-side). For profiles without avatars, use a gradient placeholder div with the same `var(--cover-gradient)` background as the existing cover art fallback.
    - Display name as large heading (`text-2xl md:text-4xl font-bold`)
    - Username shown below as `@username` in secondary text color
    - Bio text below username in normal text, full bio (not truncated -- the API returns full bio for profile pages, truncation is only for now-playing)
    - Use `var(--text-primary)` for display name, `var(--text-secondary)` for @username, `var(--text-tertiary)` for bio

    **Track catalog:**
    - Section heading "Tracks" with track count (e.g., "Tracks (12)")
    - Vertical list of tracks, each row showing:
      - Small cover art (48x48px, rounded-sm) -- if track has coverUrl, show image (prefix `/audio/` for R2 keys, pass through data: URIs as-is). If no coverUrl, show gradient placeholder.
      - Track title (font-medium, text-primary)
      - Genre badge (small pill, text-xs, bg-hover background)
      - Duration formatted as M:SS (track.duration is in milliseconds)
    - Tracks are already sorted newest-first from the API (ORDER BY created_at DESC)
    - No click-to-play behavior for now (catalog is display-only for v1.1)

    **Loading state:**
    - Show skeleton placeholders matching the hero + track list layout
    - Avatar skeleton: gray rounded-square with pulse animation
    - Name skeleton: two gray bars (wide for name, narrow for username)
    - Track list skeleton: 5 rows of gray bars matching track row layout
    - Use CSS animation `pulse` (already defined in index.css) with `var(--bg-hover)` background

    **Error state:**
    - Brief error message centered on page
    - "Try again" button styled like the existing buttons (bg-hover background, rounded, accent on hover)
    - Button calls the fetch function again

    **Empty track list:**
    - Full profile header is displayed
    - Below tracks heading, show message: "This artist hasn't submitted any tracks yet."
    - Style in text-secondary, centered or left-aligned to match track list area

    **404 handling:**
    - If the API returns 404 (error: "NOT_FOUND"), render the NotFoundPage component inline (import and render, don't navigate away)
    - This keeps the URL at /artist/:username showing "Artist not found"

    **Duration formatting utility:**
    - Create a small helper function within the file (or inline) to convert milliseconds to M:SS format
    - Example: 183000ms -> "3:03"
  </action>
  <verify>
    `cd web && npx tsc --noEmit` passes.
    The file exports a default or named ArtistProfilePage component.
    The file imports useParams from react-router and fetches /api/artist/:username.
    The file handles loading, error, 404, empty tracks, and normal rendering states.
  </verify>
  <done>
    ArtistProfilePage.tsx renders a complete artist profile with hero header (avatar, display name, @username, bio), track catalog (cover art, title, genre, duration per row), skeleton loading state, error state with retry, empty track list message, and inline 404 handling for non-existent artists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create NotFoundPage and wire profile + 404 routes in App.tsx</name>
  <files>
    web/src/pages/NotFoundPage.tsx
    web/src/App.tsx
  </files>
  <action>
    1. Create `web/src/pages/NotFoundPage.tsx`:
       - Simple centered layout with "Artist not found" message
       - Link back to radio using `<Link to="/">` from react-router (NOT an anchor tag -- must use Link to preserve audio state)
       - Style the link like text with accent color on hover
       - Keep it minimal per CONTEXT.md: "simple text message, no illustration"
       - Export as both default and named export for flexibility (ArtistProfilePage imports it inline for 404 rendering)
       - Props: optional `message` string to allow custom messages (default: "Artist not found")

    2. Update `web/src/App.tsx` route configuration:
       - Add route for `/artist/:username` rendering `<ArtistProfilePage />`
       - Add route for `/artist/by-wallet/:wallet` (placeholder for Plan 03 -- can render ArtistProfilePage with a wallet prop, or a separate WalletProfilePage. For now, just add the route pointing to a TODO comment or a simple redirect. Actually, skip this route entirely for now -- Plan 03 handles it.)
       - Replace the temporary catch-all `path="*"` (from Plan 01) with `<NotFoundPage />` for the 404 route
       - Final route structure inside the RadioLayout route:
         ```tsx
         <Route element={<RadioLayout />}>
           <Route index element={<RadioPage />} />
           <Route path="artist/:username" element={<ArtistProfilePage />} />
           <Route path="*" element={<NotFoundPage />} />
         </Route>
         ```
       - Import ArtistProfilePage and NotFoundPage at top of file

    IMPORTANT: The `<main>` wrapper in RadioLayout provides `flex-1 flex flex-col items-center justify-center px-4`. The profile page content should work within this container. If the profile page needs different layout (e.g., not vertically centered, needs full width), the profile page component should override with its own container styling. The profile page likely needs `justify-start` instead of `justify-center` since it has a long scrollable track list. Handle this by having ArtistProfilePage wrap its content in a `self-start w-full max-w-2xl` container that overrides the centering.

    Actually, re-examining RadioLayout: the `justify-center` on main is correct for RadioPage (centered content) but wrong for profile pages (top-aligned, scrollable). Two options:
    - Option A: Remove justify-center from RadioLayout main, add it to RadioPage instead
    - Option B: Have ArtistProfilePage override with self-start

    Go with Option A -- it's cleaner. Update RadioLayout's `<main>` to `flex-1 flex flex-col items-center px-4` (drop justify-center). Then update RadioPage to add `justify-center` to its own wrapper div. This way each page controls its own vertical alignment.
  </action>
  <verify>
    `cd web && npx tsc --noEmit` passes.
    `cd web && npm run build` succeeds.
    App.tsx has routes for `/`, `/artist/:username`, and `*` (404 catch-all).
    NotFoundPage.tsx uses Link component from react-router (not `<a>` tag).
  </verify>
  <done>
    NotFoundPage.tsx shows "Artist not found" with a Link back to `/`. App.tsx routes `/artist/:username` to ArtistProfilePage and `*` to NotFoundPage. RadioLayout main content area allows both centered (radio) and top-aligned (profile) layouts. The app builds and all routes are accessible.
  </done>
</task>

</tasks>

<verification>
- `cd web && npm run build` succeeds
- `cd web && npx tsc --noEmit` passes
- Route `/artist/:username` renders ArtistProfilePage
- Route `/*` (unmatched) renders NotFoundPage
- ArtistProfilePage fetches from /api/artist/:username and handles loading, error, 404, empty, and data states
- NotFoundPage uses Link (not anchor) for navigation back to radio
</verification>

<success_criteria>
1. Navigating to `/artist/someuser` fetches the profile from API and displays hero header with avatar, display name, @username, bio
2. Track catalog shows each track with cover art, title, genre, and duration
3. Non-existent username shows "Artist not found" with link back to radio
4. Loading state shows skeleton placeholders matching the actual layout
5. API error shows error message with "Try again" button
6. Empty track list shows "This artist hasn't submitted any tracks yet."
</success_criteria>

<output>
After completion, create `.planning/phases/09-frontend-profiles/09-02-SUMMARY.md`
</output>
