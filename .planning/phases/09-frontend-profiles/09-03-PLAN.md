---
phase: 09-frontend-profiles
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - web/src/components/Player/NowPlaying.tsx
  - web/src/pages/RadioPage.tsx
  - api/src/routes/artist.ts
  - web/src/pages/WalletProfilePage.tsx
  - web/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Artist display name in the player bar is a clickable link to /artist/:username"
    - "Artist name in the main radio view is a clickable link to the profile page"
    - "Wallet-only artists (no profile) show truncated wallet as clickable link to wallet profile page"
    - "Wallet profile page at /artist/by-wallet/:wallet shows identicon, wallet address, and track catalog"
    - "Clicking artist links does not interrupt audio playback"
  artifacts:
    - path: "web/src/components/Player/NowPlaying.tsx"
      provides: "Artist name rendered as Link component navigating to profile"
      contains: "Link"
    - path: "web/src/pages/WalletProfilePage.tsx"
      provides: "Wallet-based profile page with identicon, wallet address, and tracks"
      min_lines: 60
    - path: "api/src/routes/artist.ts"
      provides: "Extended by-wallet endpoint returning profile + tracks"
      contains: "ORDER BY created_at DESC"
  key_links:
    - from: "web/src/components/Player/NowPlaying.tsx"
      to: "react-router Link"
      via: "Link component wrapping artist name"
      pattern: "Link.*to=.*artist"
    - from: "web/src/pages/WalletProfilePage.tsx"
      to: "/api/artist/by-wallet/:wallet"
      via: "fetch in useEffect"
      pattern: "fetch.*by-wallet"
    - from: "web/src/pages/RadioPage.tsx"
      to: "react-router Link"
      via: "Link component wrapping displayArtist"
      pattern: "Link.*to=.*artist"
---

<objective>
Make artist names clickable links throughout the player UI and build the wallet-based profile page for artists without registered usernames.

Purpose: This completes the navigation loop -- listeners can click any artist name (whether it's a display name or truncated wallet) to visit that artist's profile page. The by-wallet API is extended to return tracks so wallet-only profiles have content.

Output: Clickable artist links in PlayerBar and RadioPage, wallet-based profile page, and extended by-wallet API endpoint.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-frontend-profiles/09-CONTEXT.md
@.planning/phases/09-frontend-profiles/09-RESEARCH.md
@.planning/phases/09-frontend-profiles/09-01-SUMMARY.md
@web/src/components/Player/NowPlaying.tsx
@web/src/pages/RadioPage.tsx
@web/src/App.tsx
@api/src/routes/artist.ts
@packages/shared/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make artist names clickable links in PlayerBar and RadioPage</name>
  <files>
    web/src/components/Player/NowPlaying.tsx
    web/src/pages/RadioPage.tsx
  </files>
  <action>
    1. Update `web/src/components/Player/NowPlaying.tsx`:
       - Import `Link` from `react-router` (NOT from `react-router-dom` -- v7 uses the single package)
       - The track prop already has `artistUsername`, `artistDisplayName`, and `artistWallet` fields (from Phase 8 enrichment)
       - Determine the display artist name:
         - If `track.artistDisplayName` exists, use it
         - Else if `track.artistName` exists, use it (legacy field from submission)
         - Else, truncate wallet: `${track.artistWallet.slice(0, 6)}...${track.artistWallet.slice(-4)}`
       - Determine the link target:
         - If `track.artistUsername` exists: `/artist/${track.artistUsername}`
         - Else: `/artist/by-wallet/${track.artistWallet}`
       - Wrap the artist name text in a `<Link>` component:
         ```tsx
         <Link
           to={artistPath}
           className="truncate transition-colors"
           style={{ fontSize: '12px', color: 'var(--text-tertiary)', textDecoration: 'none' }}
           onMouseEnter={(e) => (e.currentTarget.style.color = 'var(--accent)')}
           onMouseLeave={(e) => (e.currentTarget.style.color = 'var(--text-tertiary)')}
         >
           {displayArtist}
         </Link>
         ```
       - IMPORTANT: Use Link, not `<a>`. Anchor tags cause full page reload which destroys audio state.

    2. Update `web/src/pages/RadioPage.tsx`:
       - Import `Link` from `react-router`
       - In the track info section where `displayArtist` is shown (the `<p>` tag with cursor-pointer), replace the `<p>` with a `<Link>`:
         - Determine artist link target same as above: check crossfade.currentTrack for artistUsername or fall back to by-wallet URL
         - Apply the same hover styling (color transitions to accent)
         - Keep the same font size (15px) and secondary text color
       - Also update the "Up next" section: if nextTrack has artistName, it's currently displayed as plain text. Keep it as plain text (no link needed for up-next -- it's secondary info).
       - Access `crossfade.currentTrack` from `useAudio()` context (which should already be available in RadioPage from Plan 01)

    CRITICAL: Do NOT use `<a href>` anywhere. All internal navigation must use `<Link to>` from react-router to prevent full page reloads that would destroy the AudioContext and stop playback.
  </action>
  <verify>
    `cd web && npx tsc --noEmit` passes.
    Grep for `<a ` in NowPlaying.tsx and RadioPage.tsx returns no results (no anchor tags for internal nav).
    Grep for `Link` in NowPlaying.tsx confirms Link component is imported and used.
    Grep for `Link` in RadioPage.tsx confirms Link component is imported and used.
  </verify>
  <done>
    Artist name in PlayerBar's NowPlaying component is a clickable Link to `/artist/:username` (or `/artist/by-wallet/:wallet` for wallet-only artists). Artist name in RadioPage main content area is also a clickable Link. Both use react-router Link (not anchor tags). Display name preference: artistDisplayName > artistName > truncated wallet.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend by-wallet API and create WalletProfilePage</name>
  <files>
    api/src/routes/artist.ts
    web/src/pages/WalletProfilePage.tsx
    web/src/App.tsx
  </files>
  <action>
    1. Extend `api/src/routes/artist.ts` - the `/by-wallet/:wallet` endpoint:
       - Currently returns only `{ profile: ArtistPublicProfile }` and 404 if no profile exists.
       - Change to ALWAYS return tracks for the wallet, even if no profile exists.
       - New response shape when profile exists: `{ profile: ArtistPublicProfile, tracks: Track[] }`
       - New response shape when NO profile exists: `{ profile: null, tracks: Track[] }` with status 200 (NOT 404)
       - Only return 404 if the wallet has no profile AND no tracks (truly unknown wallet)
       - Add track query (same as the /:username endpoint):
         ```sql
         SELECT id, title, wallet, artist_name, duration, file_url, cover_url, genre, description, tags, file_hash, created_at, play_count, tip_weight
         FROM tracks WHERE wallet = ? ORDER BY created_at DESC
         ```
       - Map tracks with same logic as /:username (R2 key prefixing for fileUrl and coverUrl)
       - Keep existing 400 response for invalid wallet format
       - Update the response type: use a union type or optional profile field. Since ArtistProfileWithTracks has `profile: ArtistPublicProfile` (required), create a new response shape inline:
         ```typescript
         return c.json({ profile: profileData, tracks }, 200)
         // where profileData is ArtistPublicProfile | null
         ```

    2. Create `web/src/pages/WalletProfilePage.tsx`:
       - Uses `useParams()` to get `:wallet` from the URL
       - Fetches `GET /api/artist/by-wallet/${wallet}` on mount
       - Use API_URL from constants for the fetch base URL
       - Handles the response:
         - If profile exists (profile !== null): redirect to `/artist/${profile.username}` using `useNavigate()` from react-router (since the wallet has a registered username, show the canonical profile page)
         - If profile is null but tracks exist: render a minimal profile page with:
           - Identicon placeholder: gradient div with `var(--cover-gradient)` background (128x192px rounded-xl, same sizing as ArtistProfilePage)
           - Wallet address displayed as heading (full address, styled text-lg, mono font or normal is fine)
           - No bio section (anonymous artist)
           - Track catalog with same row format as ArtistProfilePage (cover art, title, genre, duration)
         - If 404 (no profile, no tracks): render NotFoundPage inline
       - Loading and error states: same skeleton/error pattern as ArtistProfilePage
       - Consider extracting shared components (TrackRow, ProfileSkeleton) between ArtistProfilePage and WalletProfilePage. However, to keep this plan focused, it's acceptable to duplicate the track row rendering. If the duplication is excessive (>30 lines), extract a `TrackRow` component into `web/src/components/TrackRow.tsx`.

    3. Update `web/src/App.tsx`:
       - Add route for `/artist/by-wallet/:wallet` rendering `<WalletProfilePage />`
       - Place this route AFTER `/artist/:username` but BEFORE the catch-all `*`:
         ```tsx
         <Route path="artist/:username" element={<ArtistProfilePage />} />
         <Route path="artist/by-wallet/:wallet" element={<WalletProfilePage />} />
         <Route path="*" element={<NotFoundPage />} />
         ```
       - Import WalletProfilePage at top of file

    NOTE on shared types: The by-wallet endpoint now returns a shape that doesn't match any existing shared type perfectly. It's `{ profile: ArtistPublicProfile | null, tracks: Track[] }`. Define this type inline in the WalletProfilePage fetch handler or add a new shared type. For simplicity, define it inline in the component file as a local type.
  </action>
  <verify>
    `cd web && npx tsc --noEmit` passes.
    `cd api && npx tsc --noEmit` passes (or the API build command succeeds).
    App.tsx has route for `artist/by-wallet/:wallet`.
    The by-wallet API endpoint returns tracks array in the response.
    WalletProfilePage imports useNavigate and redirects when profile has username.
  </verify>
  <done>
    The `/api/artist/by-wallet/:wallet` endpoint now returns `{ profile, tracks }` with profile being null for unregistered wallets and tracks always populated. WalletProfilePage renders at `/artist/by-wallet/:wallet` showing identicon + wallet address + track catalog for anonymous artists, or redirects to the canonical `/artist/:username` page for registered artists. App.tsx routes are complete with all three profile-related paths.
  </done>
</task>

</tasks>

<verification>
- `cd web && npm run build` succeeds
- `cd web && npx tsc --noEmit` passes
- Artist names in PlayerBar and RadioPage are Link components (not anchor tags)
- Links navigate to /artist/:username or /artist/by-wallet/:wallet based on profile data
- The by-wallet API returns tracks alongside profile data
- WalletProfilePage renders for /artist/by-wallet/:wallet route
- All routes in App.tsx: `/`, `/artist/:username`, `/artist/by-wallet/:wallet`, `*`
</verification>

<success_criteria>
1. Clicking artist display name in the PlayerBar navigates to the profile page without audio interruption
2. Clicking artist name in the RadioPage main content navigates to the profile page without audio interruption
3. Wallet-only artists link to /artist/by-wallet/:wallet which shows identicon + wallet + tracks
4. Registered artists' wallet profile pages redirect to /artist/:username (canonical URL)
5. The by-wallet API returns both profile (or null) and tracks for any wallet address
</success_criteria>

<output>
After completion, create `.planning/phases/09-frontend-profiles/09-03-SUMMARY.md`
</output>
