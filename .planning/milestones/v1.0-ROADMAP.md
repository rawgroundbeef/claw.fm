# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-03
**Phases:** 1-6
**Total Plans:** 19

## Overview

claw.fm delivers a 24/7 web radio station where AI agents submit music and listeners tip and buy tracks. The build follows the data flow: infrastructure first, then the supply side (track submission), then the scheduling brain (queue), then the listening experience (player), then monetization (payments), and finally polish. Each phase produces a working, verifiable increment -- by Phase 4 the station is listenable, by Phase 5 it generates revenue.

## Phases

### Phase 1: Foundation
**Goal**: A deployable (empty) API and frontend exist with all infrastructure bindings configured, shared types defined, and storage ready to receive data
**Depends on**: Nothing (first phase)
**Requirements**: INFR-01, INFR-02, INFR-03, INFR-06, INFR-07
**Plans**: 2 plans

Plans:
- [x] 01-01-PLAN.md -- Monorepo scaffold, shared types, Hono API with health endpoint, D1 tracks schema (Completed 2026-02-01)
- [x] 01-02-PLAN.md -- React 19 + Vite frontend with Tailwind, placeholder page, monorepo integration verification (Completed 2026-02-01)

### Phase 2: Submission Pipeline
**Goal**: An AI agent can submit a track via the API by paying 0.01 USDC, and the track is validated, stored, and persisted with correct metadata
**Depends on**: Phase 1
**Requirements**: SUBM-01, SUBM-02, SUBM-03, SUBM-04, SUBM-05, SUBM-06, SUBM-07, SUBM-08, SUBM-09
**Plans**: 4 plans

Plans:
- [x] 02-01-PLAN.md -- D1 migration for submission fields, shared types update, genres endpoint, wrangler config (Completed 2026-02-01)
- [x] 02-02-PLAN.md -- Validation libraries (file-type, duration, hash, identicon, image) and x402 payment middleware (Completed 2026-02-01)
- [x] 02-03-PLAN.md -- POST /api/submit endpoint wiring validation, payment, storage, and persistence (Completed 2026-02-01)
- [x] 02-04-PLAN.md -- Gap closure: replace x402.org fetch with @openfacilitator/sdk, remove dead imports (Completed 2026-02-01)

### Phase 3: Queue + Now-Playing
**Goal**: The station has a brain -- a cron-driven queue that selects tracks using decay-weighted rotation, advances automatically, and exposes now-playing state to any client
**Depends on**: Phase 2
**Requirements**: QUEU-01, QUEU-02, QUEU-03, QUEU-05, QUEU-06, QUEU-07, INFR-04, INFR-05
**Plans**: 3 plans

Plans:
- [x] 03-01-PLAN.md -- Shared types, decay-weighted rotation algorithm, KV cache helpers, wrangler DO/KV bindings (Completed 2026-02-01)
- [x] 03-02-PLAN.md -- QueueBrain Durable Object with SQLite state, alarm-based advancement, weighted selection (Completed 2026-02-01)
- [x] 03-03-PLAN.md -- Now-playing and queue API routes, submit immediate-start trigger, index.ts wiring (Completed 2026-02-01)

### Phase 4: Frontend Player
**Goal**: A listener can open claw.fm, press play, and hear the current track with smooth crossfade transitions, a frequency visualizer, and always know what is playing and what state the player is in
**Depends on**: Phase 3
**Requirements**: PLAY-01, PLAY-02, PLAY-03, PLAY-04, PLAY-05, PLAY-06, PLAY-07, PLAY-08, PLAY-09, UI-01, UI-04, UI-06
**Plans**: 6 plans

Plans:
- [x] 04-01-PLAN.md -- Audio utilities (AudioContext singleton, time sync, equal-power curves) and infrastructure config (Vite proxy, R2 CORS) (Completed 2026-02-01)
- [x] 04-02-PLAN.md -- Core audio engine hooks (useAudioPlayer, useCrossfade, useNowPlaying) for playback and track transitions (Completed 2026-02-01)
- [x] 04-03-PLAN.md -- Waveform visualizer (useVisualizer hook, Canvas component, idle animation) (Completed 2026-02-01)
- [x] 04-04-PLAN.md -- Player UI components (PlayerBar, PlayButton, VolumeControl, NowPlaying, ProgressBar, EmptyState) (Completed 2026-02-01)
- [x] 04-05-PLAN.md -- App.tsx integration wiring all hooks and components into the complete player application (Completed 2026-02-01)
- [x] 04-06-PLAN.md -- Error recovery and resilience (network drop, tab backgrounding, reconnection indicator) (Completed 2026-02-01)

### Phase 5: Payments + Wallet
**Goal**: A listener can tip the current artist or buy/download a track using USDC on Base, with an embedded wallet created on-demand and 95% of payment reaching the agent
**Depends on**: Phase 3, Phase 4
**Requirements**: PAY-01, PAY-02, PAY-03, PAY-04, PAY-05, PAY-06, PAY-07, PAY-08, QUEU-04
**Plans**: 3 plans

Plans:
- [x] 05-01-PLAN.md -- Web3 provider setup (OnchainKit, Wagmi, TanStack Query), wallet connection UI, USDC balance display (Completed 2026-02-02)
- [x] 05-02-PLAN.md -- Payment API endpoints (POST /api/tip for tip weight update, POST /api/downloads for presigned R2 URLs) (Completed 2026-02-02)
- [x] 05-03-PLAN.md -- Tip and buy frontend flows (USDC transfer hooks, tip buttons, buy/download button, confetti, toast notifications) (Completed 2026-02-03)

### Phase 6: Polish + Mobile + Rate Limiting
**Goal**: The station is ready for real users -- the layout works on phones and abuse is rate-limited
**Depends on**: Phase 4, Phase 5
**Requirements**: UI-05, SUBM-10
**Plans**: 1 plan

Plans:
- [x] 06-01 -- Mobile responsive layout + rate limiting (Completed 2026-02-03)

---

## Milestone Summary

**Key Decisions:**
- CF Workers + Hono + D1 + R2 stack (matches existing x402 infra)
- Embedded Smart Wallets via Coinbase OnchainKit (no signup to listen)
- Shared queue with decay-weighted rotation (true radio feel)
- Fixed tip amounts ($0.25/$1/$5) and buy price ($2)
- x402 split: 95% agent / 5% platform via direct USDC transfers
- Wallet = identity (no auth system)
- Wagmi v2 for OnchainKit compatibility
- HMAC-SHA256 presigned download URLs with 72h expiry
- Manual MP3 frame parser for Workers runtime compatibility
- Durable Object with alarm-based track advancement

**Issues Resolved:**
- music-metadata CF Workers incompatibility (manual MP3 parser fallback)
- x402.org facilitator integration (migrated to @openfacilitator/sdk)
- wagmi v3 incompatibility with OnchainKit (downgraded to v2)
- Duration display bug (was showing ~2999 min instead of ~3 min)
- Polling infinite loop from timeRemaining in useEffect deps

**Issues Deferred:**
- OnchainKit Smart Wallet UX needs real-device validation
- Large bundle size (1+ MB chunk) â€” code-splitting deferred

**Technical Debt Incurred:**
- DO stub typed as `as any` for RPC method access (TypeScript limitation)
- PLATFORM_WALLET falls back to zero address in dev

---

_For current project status, see .planning/PROJECT.md_
